"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[4677],{85821:function(e,n,t){t.r(n),t.d(n,{default:function(){return pe}});var i=t(97857),a=t.n(i),s=t(5574),c=t.n(s),l=t(3234),r=t(7306),d=t(43714),o=t(61110),u=t(71580),h=t(74815),m=t(47221),p=t(86250),g=t(42075),_=t(18334),f=t(86968),x=t(10541),k=t(99611),v=t(83062),j=t(15867),w=t(43106),Z=t(86074),b=function(e){var n=e.setSelectedDocumentIds,t=e.handleTesting,i=(0,x.aD)().documents,a=(0,f.qM)("fileManager").t,s=[{title:"Name",dataIndex:"doc_name",key:"doc_name",render:function(e){return(0,Z.jsx)("p",{children:e})}},{title:"Hits",dataIndex:"count",key:"count",width:80},{title:"View",key:"view",width:50,render:function(e,n){var t=n.doc_id,i=n.doc_name;return(0,Z.jsx)(_.Z,{documentName:i,documentId:t,prefix:"document",children:(0,Z.jsx)(v.Z,{title:a("preview"),children:(0,Z.jsx)(j.ZP,{type:"text",children:(0,Z.jsx)(k.Z,{size:20})})})})}}],c={onChange:function(e){t(e),n(e)},getCheckboxProps:function(e){return{disabled:"Disabled User"===e.doc_name,name:e.doc_name}}};return(0,Z.jsx)(w.Z,{columns:s,dataSource:i,showHeader:!1,rowSelection:c,rowKey:"doc_id"})},C=t(67421),S="selectFilesCollapse___tHbPt",y="selectFilesTitle___OKrhv",M=function(e){var n,t,i=e.onTesting,a=e.selectedDocumentIds,s=e.setSelectedDocumentIds,c=(0,C.$G)().t,l=(0,x.aD)().documents;return(0,Z.jsx)(m.Z,{expandIcon:function(){return(0,Z.jsx)(h.r,{})},className:S,items:[{key:"1",label:(0,Z.jsx)(p.Z,{justify:"space-between",align:"center",className:y,children:(0,Z.jsxs)(g.Z,{children:[(0,Z.jsxs)("span",{children:[null!==(n=null==a?void 0:a.length)&&void 0!==n?n:0,"/",null!==(t=null==l?void 0:l.length)&&void 0!==t?t:0]}),c("knowledgeDetails.filesSelected")]})}),children:(0,Z.jsx)("div",{children:(0,Z.jsx)(b,{setSelectedDocumentIds:s,handleTesting:i})})}]})},I=t(46693),N=t(2938),E=t(21612),D=t(79531),L=t(4393),F=t(21687),R=t(96074),G=t(75081),P=t(2487),T=t(55241),Q=t(66309),z=t(11980),B=t(66540),O=t(27856),V=t.n(O),J=t(96486),q=t(62435),W=t(46008),K=(t(15009),t(99289),t(91028)),H=t(60806),Y={searchPage:"searchPage___TO5ok",card:"card___scTJ7",tag:"tag___F3dia",searchSide:"searchSide___Ur4mG",modelForm:"modelForm___v4GJN",checkGroup:"checkGroup___YVVws",list:"list___FBGDW",checkbox:"checkbox___CWAZR",knowledgeName:"knowledgeName___pQK8r",embeddingId:"embeddingId___yxVE4",firstRenderContent:"firstRenderContent___kYeDC",content:"content___FJSce",hide:"hide___d1U6O",main:"main___G4gQT",highlightContent:"highlightContent___GkhyP",documentReference:"documentReference___Bj5k4",pagination:"pagination___EGLXC",answerWrapper:"answerWrapper___EIJcg",globalInput:"globalInput___jG4B8",partialInput:"partialInput___kQwzQ",appIcon:"appIcon____OfF0",appName:"appName___JGWuY",textclip:"textclip___AoVgw",popupMarkdown:"popupMarkdown___Zggfc",mindMapFloatButton:"mindMapFloatButton___GL1ZJ"},U=t(373),$=t(85265),A=t(38703),X=function(e){var n,t,i,a,s,l,r=e.data,d=e.hideModal,o=e.visible,u=e.loading,h=(0,C.$G)().t,m=(n=(0,q.useState)(0),t=c()(n,2),i=t[0],a=t[1],s=(0,q.useRef)(),l=(0,q.useCallback)((function(){s.current=setInterval((function(){a((function(e){return e>40&&clearInterval(null==s?void 0:s.current),e+1}))}),1e3)}),[]),(0,q.useEffect)((function(){return l(),function(){clearInterval(null==s?void 0:s.current)}}),[l]),Number((i/43*100).toFixed(0)));return(0,Z.jsx)($.Z,{title:h("chunk.mind"),onClose:d,open:o,width:"40vw",children:u?(0,Z.jsx)(p.Z,{justify:"center",children:(0,Z.jsx)(A.Z,{type:"circle",percent:m,size:200})}):(0,Z.jsx)(U.Z,{data:r,show:!0,style:{width:"100%",height:"100%"}})})},ee=t(9783),ne=t.n(ee),te=t(19632),ie=t.n(te),ae=t(87547),se=t(7134),ce=t(22850),le=t(36582),re=t(93967),de=t.n(re),oe=E.Z.Sider,ue=function(e){var n=e.isFirstRender,t=e.checkedList,i=e.setCheckedList,a=(0,x.VJ)(),s=a.list,l=a.loading,r=(0,q.useMemo)((function(){return s.reduce((function(e,n){var t,i=e.find((function(e){return e.key===n.embd_id})),a={title:n.name,key:n.id,isLeaf:!0};i?null===(t=i.children)||void 0===t||t.push(a):e.push({title:n.embd_id,key:n.embd_id,isLeaf:!1,children:[a]});return e}),[])}),[s]),d=(0,q.useState)([]),o=c()(d,2),u=o[0],h=o[1],m=(0,q.useState)([]),p=c()(m,2),_=p[0],f=p[1],k=(0,q.useState)(!0),v=c()(k,2),j=v[0],w=v[1],b=(0,q.useCallback)((function(e){var n=s.find((function(n){return n.id===e.key}));return(0,Z.jsxs)(g.Z,{children:[e.isLeaf&&(0,Z.jsx)(se.C,{size:24,icon:(0,Z.jsx)(ae.Z,{}),src:null==n?void 0:n.avatar}),(0,Z.jsx)(ce.Z.Text,{ellipsis:{tooltip:e.title},className:e.isLeaf?Y.knowledgeName:Y.embeddingId,children:e.title})]})}),[s]);return(0,q.useEffect)((function(){var e,n=null===(e=r[0])||void 0===e||null===(e=e.children)||void 0===e?void 0:e.map((function(e){return e.key}));n&&i(n),h(r.map((function(e){return e.key})))}),[r,h,i]),(0,Z.jsx)(oe,{className:de()(Y.searchSide,ne()({},Y.transparentSearchSide,n)),theme:"light",width:"20%",children:(0,Z.jsx)(G.Z,{spinning:l,children:(0,Z.jsx)(le.Z,{className:Y.list,checkable:!0,onExpand:function(e){h(e),w(!1)},expandedKeys:u,autoExpandParent:j,onCheck:function(e,n){console.log("onCheck",e,n);var t=e,a=[],c=n.node,l=c.isLeaf,r=c.checked,d=c.key,o=c.children;if(l){var u=s.find((function(e){return e.id===d}));if(r)a=t;else a=t.filter((function(e){return s.some((function(n){return n.id===e}))})).map((function(e){var n;return null===(n=s.find((function(n){return n.id===e})))||void 0===n?void 0:n.embd_id})).some((function(e){return e!==(null==u?void 0:u.embd_id)}))?[d]:t}else{var h;if(r)a=[];else a=[d].concat(ie()(null!==(h=null==o?void 0:o.map((function(e){return e.key})))&&void 0!==h?h:[]))}i(a)},checkedKeys:t,onSelect:function(e,n){console.log("onSelect",n),f(e)},selectedKeys:_,treeData:r,titleRender:b})})})},he=E.Z.Content,me=D.Z.Search,pe=function(){var e,n=(0,C.$G)().t,t=(0,q.useState)([]),i=c()(t,2),s=i[0],h=i[1],m=(0,x.aD)(),_=m.chunks,k=m.total,j=(0,x.VJ)().list,w=(0,q.useMemo)((function(){return s.filter((function(e){return j.some((function(n){return n.id===e}))}))}),[s,j]),b=function(e){var n,t=(0,N.H0)(H.Z.ask),i=t.send,a=t.answer,s=t.done,l=(0,x.aX)(),r=l.testChunk,d=l.loading,o=(0,q.useState)(!1),u=c()(o,2),h=u[0],m=u[1],p=(0,q.useState)({}),g=c()(p,2),_=g[0],f=g[1],k=(0,K.bP)(),v=k.fetchRelatedQuestions,j=k.data,w=(0,q.useState)(""),Z=c()(w,2),b=Z[0],C=Z[1],S=(0,q.useState)(!0),y=c()(S,2),M=y[0],I=y[1],E=(0,q.useState)([]),D=c()(E,2),L=D[0],F=D[1],R=(0,N.ye)(),G=R.pagination,P=R.setPagination,T=(0,q.useCallback)((function(n){var t=(0,J.trim)(n);(0,J.isEmpty)(t)||(P({page:1}),I(!1),f({}),m(!0),i({kb_ids:e,question:t}),r({kb_id:e,highlight:!0,question:t,page:1,size:G.pageSize}),v(t))}),[i,r,e,v,P,G.pageSize]),Q=(0,q.useCallback)((function(e){C(e.target.value)}),[]),z=(0,q.useCallback)((function(e){return function(){h||(C(e),T(e))}}),[T,h]),B=(0,q.useCallback)((function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,a=(0,J.trim)(b);h||(0,J.isEmpty)(a)||r({kb_id:e,highlight:!0,question:a,doc_ids:null!=n?n:L,page:t,size:i})}),[h,b,e,r,L]);return(0,q.useEffect)((function(){(0,J.isEmpty)(a)||f(a)}),[a]),(0,q.useEffect)((function(){s&&m(!1)}),[s]),{sendQuestion:T,handleSearchStrChange:Q,handleClickRelatedQuestion:z,handleTestChunk:B,setSelectedDocumentIds:F,loading:d,sendingLoading:h,answer:_,relatedQuestions:null!==(n=null==j?void 0:j.slice(0,5))&&void 0!==n?n:[],searchStr:b,isFirstRender:M,selectedDocumentIds:L,isSearchStrEmpty:(0,J.isEmpty)((0,J.trim)(b))}}(w),S=b.sendQuestion,y=b.handleClickRelatedQuestion,D=b.handleSearchStrChange,O=b.handleTestChunk,U=b.setSelectedDocumentIds,$=b.answer,A=b.sendingLoading,ee=b.relatedQuestions,ne=b.searchStr,te=b.loading,ie=b.isFirstRender,ae=b.selectedDocumentIds,se=b.isSearchStrEmpty,ce=(0,u.B)(),le=ce.visible,re=ce.hideModal,de=ce.documentId,oe=ce.selectedChunk,pe=ce.clickDocumentButton,ge=(0,N.ye)().pagination,_e=function(e,n){var t=(0,f.pG)(),i=t.visible,a=t.showModal,s=t.hideModal,c=(0,q.useRef)(),l=(0,K.Ys)(),r=l.fetchMindMap;return{mindMap:l.data,mindMapVisible:i,mindMapLoading:l.loading,showMindMapModal:(0,q.useCallback)((function(){var t={question:(0,J.trim)(n),kb_ids:e};(0,J.isEmpty)(t.question)||(0,J.isEqual)(t,c.current)||(c.current=t,r(t)),a()}),[r,a,n,e]),hideMindMapModal:s}}(w,ne),fe=_e.mindMapVisible,xe=_e.hideMindMapModal,ke=_e.showMindMapModal,ve=_e.mindMapLoading,je=_e.mindMap,we=(0,Z.jsx)(me,{value:ne,onChange:D,placeholder:n("header.search"),allowClear:!0,enterButton:!0,onSearch:S,size:"large",loading:A,disabled:0===w.length,className:ie?Y.globalInput:Y.partialInput});return(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsxs)(E.Z,{className:Y.searchPage,children:[(0,Z.jsx)(ue,{isFirstRender:ie,checkedList:w,setCheckedList:h}),(0,Z.jsx)(E.Z,{className:ie?Y.mainLayout:"",children:(0,Z.jsx)(he,{children:ie?(0,Z.jsx)(p.Z,{justify:"center",className:Y.firstRenderContent,children:(0,Z.jsx)(p.Z,{vertical:!0,align:"center",gap:"large",children:we})}):(0,Z.jsx)(p.Z,{className:Y.content,children:(0,Z.jsxs)("section",{className:Y.main,children:[we,(0,Z.jsx)(L.Z,{title:(0,Z.jsxs)(p.Z,{gap:10,children:[(0,Z.jsx)("img",{src:"/logo.svg",alt:"",width:20}),n("chat.answerTitle")]}),className:Y.answerWrapper,children:(0,J.isEmpty)($)&&A?(0,Z.jsx)(F.Z,{active:!0}):$.answer&&(0,Z.jsx)(W.Z,{loading:A,content:$.answer,reference:null!==(e=$.reference)&&void 0!==e?e:{},clickDocumentButton:pe})}),(0,Z.jsx)(R.Z,{}),(0,Z.jsx)(M,{selectedDocumentIds:ae,setSelectedDocumentIds:U,onTesting:O}),(0,Z.jsx)(R.Z,{}),(0,Z.jsx)(G.Z,{spinning:te,children:(null==_?void 0:_.length)>0&&(0,Z.jsx)(P.Z,{dataSource:_||[],className:Y.chunks,renderItem:function(e){return(0,Z.jsx)(P.Z.Item,{children:(0,Z.jsx)(L.Z,{className:Y.card,children:(0,Z.jsxs)(g.Z,{children:[(0,Z.jsx)(d.s,{id:e.img_id}),(0,Z.jsxs)(p.Z,{vertical:!0,gap:10,children:[(0,Z.jsx)(T.Z,{content:(0,Z.jsx)("div",{className:Y.popupMarkdown,children:(0,Z.jsx)(r.Z,{children:e.content_with_weight})}),children:(0,Z.jsx)("div",{dangerouslySetInnerHTML:{__html:V().sanitize("".concat(e.highlight,"..."))},className:Y.highlightContent})}),(0,Z.jsxs)(g.Z,{className:Y.documentReference,onClick:function(){return pe(e.doc_id,e)},children:[(0,Z.jsx)(l.Z,{id:e.image_id,name:e.docnm_kwd}),e.docnm_kwd]})]})]})})})}})}),(null==ee?void 0:ee.length)>0&&(0,Z.jsx)(L.Z,{title:n("chat.relatedQuestion"),children:(0,Z.jsx)(p.Z,{wrap:"wrap",gap:"10px 0",children:null==ee?void 0:ee.map((function(e,n){return(0,Z.jsx)(Q.Z,{className:Y.tag,onClick:y(e),children:e},n)}))})}),(0,Z.jsx)(R.Z,{}),(0,Z.jsx)(z.Z,a()(a()({},ge),{},{total:k,onChange:function(e,n){var t;null===(t=ge.onChange)||void 0===t||t.call(ge,e,n),O(ae,e,n)},className:Y.pagination}))]})})})})]}),!ie&&!se&&!(0,J.isEmpty)(w)&&(0,Z.jsx)(v.Z,{title:n("chunk.mind"),zIndex:1,children:(0,Z.jsx)(B.Z,{className:Y.mindMapFloatButton,onClick:ke,icon:(0,Z.jsx)(I.Z,{name:"paper-clip",width:24,height:30})})}),le&&(0,Z.jsx)(o.Z,{visible:le,hideModal:re,documentId:de,chunk:oe}),fe&&(0,Z.jsx)(X,{visible:fe,hideModal:xe,data:je,loading:ve})]})}},74815:function(e,n,t){t.d(n,{r:function(){return d}});var i=t(62435),a=Object.defineProperty,s=Object.getOwnPropertySymbols,c=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,r=(e,n,t)=>n in e?a(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t;const d=e=>i.createElement("svg",((e,n)=>{for(var t in n||(n={}))c.call(n,t)&&r(e,t,n[t]);if(s)for(var t of s(n))l.call(n,t)&&r(e,t,n[t]);return e})({width:20,height:20,fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),i.createElement("path",{d:"M6.667 10h6.666M6.5 17.5h7c1.4 0 2.1 0 2.635-.273a2.5 2.5 0 0 0 1.092-1.092c.273-.535.273-1.235.273-2.635v-7c0-1.4 0-2.1-.273-2.635a2.5 2.5 0 0 0-1.092-1.093C15.6 2.5 14.9 2.5 13.5 2.5h-7c-1.4 0-2.1 0-2.635.272a2.5 2.5 0 0 0-1.093 1.093C2.5 4.4 2.5 5.1 2.5 6.5v7c0 1.4 0 2.1.272 2.635a2.5 2.5 0 0 0 1.093 1.092C4.4 17.5 5.1 17.5 6.5 17.5Z",stroke:"#7F56D9",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"}))}}]);
//# sourceMappingURL=p__search__index.be35a610.async.js.map