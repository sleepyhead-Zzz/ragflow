(self.webpackChunk=self.webpackChunk||[]).push([[9859],{3234:function(e,n,t){"use strict";t.d(n,{Z:function(){return s}});var r=t(5089),a=t(46693),i=t(93352),u=t(62435),o="thumbnailImg___cbGoI",c=t(86074),s=function(e){var n=e.name,t=e.id,s=(0,r.RT)(n),l=(0,i.x2)(),d=l.data,f=l.setDocumentIds,h=d[t];return(0,u.useEffect)((function(){t&&f([t])}),[t,f]),h?(0,c.jsx)("img",{src:h,className:o}):(0,c.jsx)(a.Z,{name:"file-icon/".concat(s),width:24})}},7306:function(e,n,t){"use strict";t.d(n,{Z:function(){return k}});var r=t(97857),a=t.n(r),i=t(13769),u=t.n(i),o=t(93967),c=t.n(o),s=t(95246),l=t(21373),d=t(30402),f=t(7657),h=t(78600),g=t(77437),p=(t(81897),t(71250)),v="text___QzeTq",m="code___dMLXp",y=t(86074),x=["children","className","node"],k=function(e){var n=e.children;return(0,y.jsx)(s.U,{remarkPlugins:[h.Z,g.Z],rehypePlugins:[f.Z,d.Z],className:c()(v),components:{code:function(e){var n=e.children,t=e.className,r=(e.node,u()(e,x)),i=/language-(\w+)/.exec(t||"");return i?(0,y.jsx)(l.Z,a()(a()({},r),{},{PreTag:"div",language:i[1],children:String(n).replace(/\n$/,"")})):(0,y.jsx)("code",a()(a()({},r),{},{className:"".concat(t," ").concat(m),children:n}))}},children:n?(0,p.CE)(n):n})}},43714:function(e,n,t){"use strict";t.d(n,{s:function(){return y},Z:function(){return m}});var r=t(97857),a=t.n(r),i=t(13769),u=t.n(i),o=t(60806),c=t(55241),s=t(93967),l=t.n(s),d="primitiveImg___VkCiH",f="image___BCkCB",h="imagePreview___qFyP3",g=t(86074),p=["id","className"],v=function(e){var n=e.id,t=e.className,r=u()(e,p);return(0,g.jsx)("img",a()(a()({},r),{},{src:"".concat(o.N,"/document/image/").concat(n),alt:"",className:l()(d,t)}))},m=v,y=function(e){var n=e.id;return(0,g.jsx)(c.Z,{placement:"left",content:(0,g.jsx)(v,{id:n,className:h}),children:(0,g.jsx)(v,{id:n,className:f})})}},373:function(e,n,t){"use strict";var r=t(15009),a=t.n(r),i=t(99289),u=t.n(i),o=t(25098),c=t.n(o),s=t(97857),l=t.n(s),d=t(5574),f=t.n(d),h=t(12444),g=t.n(h),p=t(72004),v=t.n(p),m=t(28785),y=t.n(m),x=t(48374),k=t.n(x),b=t(31996),w=t.n(b),_=t(26037),C=t.n(_),P=t(9783),Z=t.n(P),N=t(1242),j=t(38622),S=t(41609),E=t.n(S),K=t(62435),F=t(4511),I=t(86074),D="root",T=["#5B8FF9","#F6BD16","#5AD8A6","#945FB9","#E86452","#6DC8EC","#FF99C3","#1E9493","#FF9845","#5D7092"],L="collapse-expand",A=function(e){w()(t,e);var n=C()(t);function t(e){return g()(this,t),Object.assign(e.style,t.defaultStyleProps),n.call(this,e)}return v()(t,[{key:"childrenData",get:function(){var e;return null===(e=this.attributes.context)||void 0===e?void 0:e.model.getChildrenData(this.id)}},{key:"getKeyStyle",value:function(e){var n=this.getSize(e),r=f()(n,2),a=r[0],i=r[1],u=y()(k()(t.prototype),"getKeyStyle",this).call(this,e);return l()(l()({width:a,height:i},u),{},{fill:"transparent"})}},{key:"drawKeyShape",value:function(e,n){var t=this.getKeyStyle(e);return this.upsert("key",N.UL,t,n)}},{key:"getLabelStyle",value:function(e){return!(!1===e.label||!e.labelText)&&(0,j.zs)(this.getGraphicStyle(e),"label")}},{key:"drawIconArea",value:function(e,n){var t=this.getSize(e),r={fill:"transparent",height:30,width:12,x:-6,y:f()(t,2)[1],zIndex:-1};this.upsert("icon-area",N.UL,r,n)}},{key:"forwardEvent",value:function(e,n,t){e&&!Reflect.has(e,"__bind__")&&(Reflect.set(e,"__bind__",!0),e.addEventListener(n,t))}},{key:"getCountStyle",value:function(e){var n=e.collapsed,t=e.color;if(n){var r,a=this.getSize(e),i=f()(a,2)[1];return{backgroundFill:t,cursor:"pointer",fill:"#fff",fontSize:8,padding:[0,10],text:"".concat(null===(r=this.childrenData)||void 0===r?void 0:r.length),textAlign:"center",y:i+8}}return!1}},{key:"drawCountShape",value:function(e,n){var t=this,r=this.getCountStyle(e),a=this.upsert("count",j.Ct,r,n);this.forwardEvent(a,j.C9.CLICK,(function(n){n.stopPropagation(),e.context.graph.emit(L,{id:t.id,collapsed:!1})}))}},{key:"isShowCollapse",value:function(e){var n;return!e.collapsed&&Array.isArray(this.childrenData)&&(null===(n=this.childrenData)||void 0===n?void 0:n.length)>0}},{key:"getCollapseStyle",value:function(e){var n=e.showIcon,t=e.color;if(!this.isShowCollapse(e))return!1;var r=this.getSize(e);return{visibility:n?"visible":"hidden",backgroundFill:t,backgroundHeight:12,backgroundWidth:12,cursor:"pointer",fill:"#fff",fontFamily:"iconfont",fontSize:8,text:"",textAlign:"center",x:-1,y:f()(r,2)[1]+8}}},{key:"drawCollapseShape",value:function(e,n){var t=this,r=this.getCollapseStyle(e),a=this.upsert("collapse-expand",j.Ct,r,n);this.forwardEvent(a,j.C9.CLICK,(function(n){n.stopPropagation(),e.context.graph.emit(L,{id:t.id,collapsed:!e.collapsed})}))}},{key:"getAddStyle",value:function(e){var n=e.collapsed,t=e.showIcon;if(n)return!1;var r=this.getSize(e),a="#ddd";return{visibility:t?"visible":"hidden",backgroundFill:"#fff",backgroundHeight:12,backgroundLineWidth:1,backgroundStroke:a,backgroundWidth:12,cursor:"pointer",fill:a,fontFamily:"iconfont",text:"",textAlign:"center",x:-1,y:f()(r,2)[1]+(this.isShowCollapse(e)?22:8)}}},{key:"render",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.parsedAttributes,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this;y()(k()(t.prototype),"render",this).call(this,e,n),this.drawCountShape(e,n),this.drawIconArea(e,n),this.drawCollapseShape(e,n)}}]),t}(j.Hd);Z()(A,"defaultStyleProps",{ports:[{key:"in",placement:"right-bottom"},{key:"out",placement:"left-bottom"}]});var z=function(e){w()(t,e);var n=C()(t);function t(){return g()(this,t),n.apply(this,arguments)}return v()(t,[{key:"getControlPoints",value:function(e,n,t){return[[f()(n,1)[0],f()(t,2)[1]]]}}]),t}(j.aH),B=function(e){w()(t,e);var n=C()(t);function t(e,r){var i;return g()(this,t),i=n.call(this,e,r),Z()(c()(i),"status","idle"),Z()(c()(i),"showIcon",(function(e){i.setIcon(e,!0)})),Z()(c()(i),"hideIcon",(function(e){i.setIcon(e,!1)})),Z()(c()(i),"setIcon",(function(e,n){if("idle"===i.status){var t=e.target.id,r=i.context,a=r.graph,u=r.element;a.updateNodeData([{id:t,style:{showIcon:n}}]),null==u||u.draw({animation:!1,silence:!0})}})),Z()(c()(i),"onCollapseExpand",function(){var e=u()(a()().mark((function e(n){var t,r,u;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i.status="busy",t=n.id,r=n.collapsed,u=i.context.graph,!r){e.next=8;break}return e.next=6,u.collapseElement(t);case 6:e.next=10;break;case 8:return e.next=10,u.expandElement(t);case 10:i.status="idle";case 11:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()),i.bindEvents(),i}return v()(t,[{key:"update",value:function(e){this.unbindEvents(),y()(k()(t.prototype),"update",this).call(this,e),this.bindEvents()}},{key:"bindEvents",value:function(){var e=this.context.graph;e.on(j.bG.POINTER_ENTER,this.showIcon),e.on(j.bG.POINTER_LEAVE,this.hideIcon),e.on(L,this.onCollapseExpand)}},{key:"unbindEvents",value:function(){var e=this.context.graph;e.off(j.bG.POINTER_ENTER,this.showIcon),e.off(j.bG.POINTER_LEAVE,this.hideIcon),e.off(L,this.onCollapseExpand)}}]),t}(j.Zt);function R(e){var n=e.error;return(0,I.jsxs)("div",{role:"alert",children:[(0,I.jsx)("p",{children:"Something went wrong:"}),(0,I.jsx)("pre",{style:{color:"red"},children:n.message})]})}(0,j.z2)(j.MD.NODE,"indented",A),(0,j.z2)(j.MD.EDGE,"indented",z),(0,j.z2)(j.MD.BEHAVIOR,"collapse-expand-tree",B);n.Z=function(e){var n=e.data,t=e.show,r=e.style,i=void 0===r?{}:r,o=(0,K.useRef)(null),c=(0,K.useRef)(null),s=K.useCallback((function e(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;n.id||(n.id=t?"".concat(t,"-").concat(r):"root"),n.children&&n.children.forEach((function(t,r){return e(t,n.id,r)}))}),[]),d=(0,K.useCallback)(function(){var e=u()(a()().mark((function e(n){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=new j.kJ({container:o.current,x:60,node:{type:"indented",style:{size:function(e){return[6*e.id.length+10,20]},labelBackground:function(e){return e.id===D},labelBackgroundRadius:0,labelBackgroundFill:"#576286",labelFill:function(e){return e.id===D?"#fff":"#666"},labelText:function(e){var n;return(null===(n=e.style)||void 0===n?void 0:n.labelText)||e.id},labelTextAlign:function(e){return e.id===D?"center":"left"},labelTextBaseline:"top",color:function(e){var n=t.getAncestorsData(e.id,"tree").length-1;return T[n%T.length]||"#576286"}},state:{selected:{lineWidth:0,labelFill:"#40A8FF",labelBackground:!0,labelFontWeight:"normal",labelBackgroundFill:"#e8f7ff",labelBackgroundRadius:10}}},edge:{type:"indented",style:{radius:16,lineWidth:2,sourcePort:"out",targetPort:"in",stroke:function(e){var n=t.getAncestorsData(e.source,"tree").length;return T[n%T.length]||"black"}}},layout:{type:"indented",direction:"LR",isHorizontal:!0,indent:40,getHeight:function(){return 20},getVGap:function(){return 10}},behaviors:["scroll-canvas","collapse-expand-tree",{type:"click-select",enable:function(e){return"node"===e.targetType&&e.target.id!==D}}]}),c.current&&c.current.destroy(),c.current=t,s(n),null==t||t.setData((0,j.RN)(n)),null==t||t.render();case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),[s]);return(0,K.useEffect)((function(){E()(n)||d(n)}),[d,n]),(0,I.jsx)(F.SV,{fallbackRender:R,children:(0,I.jsx)("div",{id:"tree",ref:o,style:l()({width:"90vw",height:"80vh",display:t?"block":"none"},i)})})}},18334:function(e,n,t){"use strict";var r=t(5089),a=(t(62435),t(86074));n.Z=function(e){var n=e.children,t=e.link,i=e.preventDefault,u=void 0!==i&&i,o=e.color,c=void 0===o?"rgb(15, 79, 170)":o,s=e.documentId,l=e.documentName,d=e.prefix,f=void 0===d?"file":d,h=t,g=(0,r.RT)(l);return t||(h="/document/".concat(s,"?ext=").concat(g,"&prefix=").concat(f)),(0,a.jsx)("a",{target:"_blank",onClick:!u||(0,r.Ep)(g)?void 0:function(e){return e.preventDefault()},href:h,rel:"noreferrer",style:{color:c,wordBreak:"break-all"},children:n})}},71580:function(e,n,t){"use strict";t.d(n,{B:function(){return o}});var r=t(5574),a=t.n(r),i=t(86968),u=t(62435),o=function(){var e=(0,i.pG)(),n=e.visible,t=e.showModal,r=e.hideModal,o=(0,u.useState)({}),c=a()(o,2),s=c[0],l=c[1],d=(0,u.useState)(""),f=a()(d,2),h=f[0],g=f[1],p=(0,u.useCallback)((function(e,n){t(),l(n),g(e)}),[t]);return{clickDocumentButton:p,visible:n,showModal:t,hideModal:r,selectedChunk:s,documentId:h}}},61110:function(e,n,t){"use strict";t.d(n,{Z:function(){return y}});var r=t(85265),a=t(97857),i=t.n(a),u=t(5574),o=t.n(u),c=t(93352),s=t(4772),l=t(21687),d=t(62435),f=t(49723),h=t(96449),g="documentContainer___kWzt7",p=t(86074),v=function(e){var n=e.comment;return n.text?(0,p.jsxs)("div",{className:"Highlight__popup",children:[n.emoji," ",n.text]}):null},m=function(e){var n=e.chunk,t=e.documentId,r=e.visible,a=(0,c.pC)(t),u=(0,c.tl)(n),m=u.highlights,y=u.setWidthAndHeight,x=(0,d.useRef)((function(){})),k=(0,d.useState)(!1),b=o()(k,2),w=b[0],_=b[1],C=a(),P=(0,h.s)(C),Z=function(){};return(0,d.useEffect)((function(){_(r)}),[r]),(0,d.useEffect)((function(){m.length>0&&w&&(_(!1),x.current(m[0]))}),[m,w]),(0,p.jsx)("div",{className:g,children:(0,p.jsx)(f.Hz,{url:C,beforeLoad:(0,p.jsx)(l.Z,{active:!0}),workerSrc:"/pdfjs-dist/pdf.worker.min.js",errorMessage:(0,p.jsx)(s.Z,{children:P}),children:function(e){return e.getPage(1).then((function(e){var n=e.getViewport({scale:1}),t=n.width,r=n.height;y(t,r)})),(0,p.jsx)(f.Nb,{pdfDocument:e,enableAreaSelection:function(e){return e.altKey},onScrollChange:Z,scrollRef:function(e){x.current=e,_(!0)},onSelectionFinished:function(){return null},highlightTransform:function(e,n,t,r,a,u,o){var c=!Boolean(e.content&&e.content.image)?(0,p.jsx)(f.y$,{isScrolledTo:o,position:e.position,comment:e.comment}):(0,p.jsx)(f.PD,{isScrolledTo:o,highlight:e,onChange:function(){}});return(0,p.jsx)(f.GI,{popupContent:(0,p.jsx)(v,i()({},e)),onMouseOver:function(n){return t(e,(function(){return n}))},onMouseOut:r,children:c},n)},highlights:m})}})})},y=function(e){var n=e.visible,t=void 0!==n&&n,a=e.hideModal,i=e.documentId,u=e.chunk;return(0,p.jsx)(r.Z,{title:"Document Previewer",onClose:a,open:t,width:"50vw",children:(0,p.jsx)(m,{documentId:i,chunk:u,visible:t})})}},96449:function(e,n,t){"use strict";t.d(n,{s:function(){return d}});var r=t(15009),a=t.n(r),i=t(99289),u=t.n(i),o=t(5574),c=t.n(o),s=t(87066),l=t(62435),d=function(e){var n=(0,l.useState)(""),t=c()(n,2),r=t[0],i=t[1],o=(0,l.useCallback)(u()(a()().mark((function n(){var t,r;return a()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,s.Z.get(e);case 2:t=n.sent,0!==(r=t.data).code&&i(null==r?void 0:r.message);case 5:case"end":return n.stop()}}),n)}))),[e]);return(0,l.useEffect)((function(){o()}),[o]),r}},10541:function(e,n,t){"use strict";t.d(n,{$F:function(){return q},$G:function(){return I},E2:function(){return E},L5:function(){return j},MA:function(){return K},ME:function(){return S},PX:function(){return P},Q7:function(){return T},Sq:function(){return z},VJ:function(){return Z},aD:function(){return D},aX:function(){return F},lX:function(){return L},pY:function(){return N},rd:function(){return R},uG:function(){return A},w9:function(){return C},z5:function(){return B}});var r=t(97857),a=t.n(r),i=t(15009),u=t.n(i),o=t(99289),c=t.n(o),s=t(5574),l=t.n(s),d=t(40063),f=t(73955),h=t(78551),g=t(4614),p=t(30202),v=t(4527),m=t(99346),y=t(58580),x=t(45360),k=t(62435),b=t(24701),w=t(2938),_=t(96100),C=function(){var e=(0,b.lr)();return l()(e,1)[0].get("id")||""},P=function(){var e,n=C(),t=(0,h.a)({queryKey:["fetchKnowledgeDetail"],initialData:{},gcTime:0,queryFn:(e=c()(u()().mark((function e(){var t,r,a;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.ZP.get_kb_detail({kb_id:n});case 2:return r=e.sent,a=r.data,e.abrupt("return",null!==(t=null==a?void 0:a.data)&&void 0!==t?t:{});case 5:case"end":return e.stop()}}),e)}))),function(){return e.apply(this,arguments)})});return{data:t.data,loading:t.isFetching}},Z=function(){var e,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=(0,h.a)({queryKey:["fetchKnowledgeList"],initialData:[],gcTime:0,queryFn:(e=c()(u()().mark((function e(){var t,r,a,i,o;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.ZP.getList();case 2:return a=e.sent,i=a.data,o=null!==(t=null==i||null===(r=i.data)||void 0===r?void 0:r.kbs)&&void 0!==t?t:[],e.abrupt("return",n?o.filter((function(e){return e.chunk_num>0})):o);case 6:case"end":return e.stop()}}),e)}))),function(){return e.apply(this,arguments)})});return{list:t.data,loading:t.isFetching}},N=function(){var e=Z().list;return null==e?void 0:e.map((function(e){return{label:e.name,value:e.id}}))},j=function(){var e,n=(0,w.Qe)(),t=n.searchString,r=n.handleInputChange,a=(0,y.Z)(t,{wait:500}),i=(0,g.N)({queryKey:["infiniteFetchKnowledgeList",a],queryFn:(e=c()(u()().mark((function e(n){var t,r,i,o,c;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.pageParam,e.next=3,f.ZP.getList({page:r,page_size:30,keywords:a});case 3:return i=e.sent,o=i.data,c=null!==(t=null==o?void 0:o.data)&&void 0!==t?t:[],e.abrupt("return",c);case 7:case"end":return e.stop()}}),e)}))),function(n){return e.apply(this,arguments)}),initialPageParam:1,getNextPageParam:function(e,n,t){if(30*t<=e.total)return t+1}}),o=i.data,s=i.error,l=i.fetchNextPage,d=i.hasNextPage,h=i.isFetching;return{data:o,loading:h,error:s,fetchNextPage:l,hasNextPage:d,isFetching:h,isFetchingNextPage:i.isFetchingNextPage,status:i.status,handleInputChange:r,searchString:t}},S=function(){var e,n=(0,p.NL)(),t=(0,v.D)({mutationKey:["createKnowledge"],mutationFn:(e=c()(u()().mark((function e(t){var r,a,i;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.ZP.createKb(t);case 2:return r=e.sent,a=r.data,0===(i=void 0===a?{}:a).code&&(x.ZP.success(d.Z.t("message.".concat(null!=t&&t.id?"modified":"created"))),n.invalidateQueries({queryKey:["fetchKnowledgeList"]})),e.abrupt("return",i);case 7:case"end":return e.stop()}}),e)}))),function(n){return e.apply(this,arguments)})});return{data:t.data,loading:t.isPending,createKnowledge:t.mutateAsync}},E=function(){var e,n=(0,p.NL)(),t=(0,v.D)({mutationKey:["deleteKnowledge"],mutationFn:(e=c()(u()().mark((function e(t){var r,a,i;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.ZP.rmKb({kb_id:t});case 2:return a=e.sent,0===(i=a.data).code&&(x.ZP.success(d.Z.t("message.deleted")),n.invalidateQueries({queryKey:["infiniteFetchKnowledgeList"]})),e.abrupt("return",null!==(r=null==i?void 0:i.data)&&void 0!==r?r:[]);case 6:case"end":return e.stop()}}),e)}))),function(n){return e.apply(this,arguments)})});return{data:t.data,loading:t.isPending,deleteKnowledge:t.mutateAsync}},K=function(){var e,n=C(),t=(0,p.NL)(),r=(0,v.D)({mutationKey:["saveKnowledge"],mutationFn:(e=c()(u()().mark((function e(r){var i,o,c;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.ZP.updateKb(a()({kb_id:n},r));case 2:return i=e.sent,o=i.data,0===(c=void 0===o?{}:o).code&&(x.ZP.success(d.Z.t("message.updated")),t.invalidateQueries({queryKey:["fetchKnowledgeDetail"]})),e.abrupt("return",c);case 7:case"end":return e.stop()}}),e)}))),function(n){return e.apply(this,arguments)})});return{data:r.data,loading:r.isPending,saveKnowledgeConfiguration:r.mutateAsync}},F=function(){var e,n=C(),t=(0,_.fz)(),r=t.page,i=t.size,o=(0,v.D)({mutationKey:["testChunk"],gcTime:0,mutationFn:(e=c()(u()().mark((function e(t){var o,c,s,l,d;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.ZP.retrieval_test(a()(a()({},t),{},{kb_id:null!==(o=t.kb_id)&&void 0!==o?o:n,page:r,size:i}));case 2:if(s=e.sent,0!==(l=s.data).code){e.next=7;break}return d=l.data,e.abrupt("return",a()(a()({},d),{},{documents:d.doc_aggs}));case 7:return e.abrupt("return",null!==(c=null==l?void 0:l.data)&&void 0!==c?c:{chunks:[],documents:[],total:0});case 8:case"end":return e.stop()}}),e)}))),function(n){return e.apply(this,arguments)})}),s=o.data;return{data:null!=s?s:{chunks:[],documents:[],total:0},loading:o.isPending,testChunk:o.mutateAsync}},I=function(){return(0,m.B)({mutationKey:["testChunk"]})>0},D=function(){var e;return null!==(e=(0,m.S)({filters:{mutationKey:["testChunk"]},select:function(e){return e.state.data}}).at(-1))&&void 0!==e?e:{chunks:[],documents:[],total:0}},T=function(){return"success"===(0,m.S)({filters:{mutationKey:["testChunk"]},select:function(e){return e.state.status}}).at(-1)},L=function(){var e,n=C(),t=(0,h.a)({queryKey:["fetchTagList"],initialData:[],gcTime:0,queryFn:(e=c()(u()().mark((function e(){var t,r,a;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,f.QL)(n);case 2:return t=e.sent,r=t.data,a=(null==r?void 0:r.data)||[],e.abrupt("return",a);case 6:case"end":return e.stop()}}),e)}))),function(){return e.apply(this,arguments)})});return{list:t.data,loading:t.isFetching}},A=function(){var e,n=C(),t=(0,p.NL)(),r=(0,v.D)({mutationKey:["deleteTag"],mutationFn:(e=c()(u()().mark((function e(r){var a,i,o;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,f.tc)(n,r);case 2:return i=e.sent,0===(o=i.data).code&&(x.ZP.success(d.Z.t("message.deleted")),t.invalidateQueries({queryKey:["fetchTagList"]})),e.abrupt("return",null!==(a=null==o?void 0:o.data)&&void 0!==a?a:[]);case 6:case"end":return e.stop()}}),e)}))),function(n){return e.apply(this,arguments)})});return{data:r.data,loading:r.isPending,deleteTag:r.mutateAsync}},z=function(){var e,n=C(),t=(0,p.NL)(),r=(0,v.D)({mutationKey:["renameTag"],mutationFn:(e=c()(u()().mark((function e(r){var a,i,o;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,f.Re)(n,r);case 2:return i=e.sent,0===(o=i.data).code&&(x.ZP.success(d.Z.t("message.modified")),t.invalidateQueries({queryKey:["fetchTagList"]})),e.abrupt("return",null!==(a=null==o?void 0:o.data)&&void 0!==a?a:[]);case 6:case"end":return e.stop()}}),e)}))),function(n){return e.apply(this,arguments)})});return{data:r.data,loading:r.isPending,renameTag:r.mutateAsync}},B=function(){return(0,m.B)({mutationKey:["renameTag"]})>0},R=function(){var e,n=(0,k.useState)([]),t=l()(n,2),r=t[0],a=t[1],i=(0,h.a)({queryKey:["fetchTagListByKnowledgeIds"],enabled:r.length>0,initialData:[],gcTime:0,queryFn:(e=c()(u()().mark((function e(){var n,t,a;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.ZP.listTagByKnowledgeIds({kb_ids:r.join(",")});case 2:return n=e.sent,t=n.data,a=(null==t?void 0:t.data)||[],e.abrupt("return",a);case 6:case"end":return e.stop()}}),e)}))),function(){return e.apply(this,arguments)})});return{list:i.data,loading:i.isFetching,setKnowledgeIds:a}};function q(){var e,n=C(),t=(0,h.a)({queryKey:["fetchKnowledgeGraph",n],initialData:{graph:{},mind_map:{}},enabled:!!n,gcTime:0,queryFn:(e=c()(u()().mark((function e(){var t,r;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,f.$V)(n);case 2:return t=e.sent,r=t.data,e.abrupt("return",null==r?void 0:r.data);case 5:case"end":return e.stop()}}),e)}))),function(){return e.apply(this,arguments)})});return{data:t.data,loading:t.isFetching}}},46008:function(e,n,t){"use strict";t.d(n,{Z:function(){return G}});var r=t(97857),a=t.n(r),i=t(13769),u=t.n(i),o=t(43714),c=t(46693),s=t(5089),l=t(45605),d=t(86250),f=t(55241),h=t(42075),g=t(15867),p=t(27856),v=t.n(p),m=t(62435),y=t(95246),x=t(59632),k=t.n(x),b=t(86592),w=t(30402),_=t(7657),C=t(78600),P=t(77437),Z=t(88718),N=t(93352),j=t(67421),S=(t(81897),t(71250)),E=t(35293),K=t(78230),F="markdownContentWrapper___geQCE",I="referencePopoverWrapper___rn9A6",D="referenceChunkImage___LoR67",T="referenceImagePreview___kcQgd",L="chunkContentText___vcP0P",A="documentLink___USud0",z="referenceIcon___g5Mgk",B="fileThumbnail___BzBir",R=t(86074),q=["children","className","node"],M=/(~{2}\d+={2})/g,G=function(e){var n=e.reference,t=e.clickDocumentButton,r=e.content,i=(0,j.$G)().t,p=(0,N.x2)(),x=p.setDocumentIds,G=p.data,H=(0,m.useMemo)((function(){var e=r;""===e&&(e=i("chat.searching"));var n=(0,E.fL)(e);return(0,K.pipe)(S.hH,S.CE)(n)}),[r,i]);(0,m.useEffect)((function(){var e=null==n?void 0:n.doc_aggs;x(Array.isArray(e)?e.map((function(e){return e.doc_id})):[])}),[n,x]);var Q=(0,m.useCallback)((function(e,n,r,a){return function(){if(r)null==t||t(e,n);else{if(!a)return;window.open(a,"_blank")}}}),[t]),W=(0,m.useCallback)((function(e){var t,r,a,i=(null!==(t=null==n?void 0:n.chunks)&&void 0!==t?t:[])[e],u=null==n||null===(r=n.doc_aggs)||void 0===r?void 0:r.find((function(e){return(null==e?void 0:e.doc_id)===(null==i?void 0:i.document_id)})),l=null==u?void 0:u.doc_id,p=null==u?void 0:u.url,m=l?G[l]:"",y=l?(0,s.RT)(null==u?void 0:u.doc_name):"",x=null==i?void 0:i.image_id;return(0,R.jsxs)(d.Z,{gap:10,className:I,children:[x&&(0,R.jsx)(f.Z,{placement:"left",content:(0,R.jsx)(o.Z,{id:x,className:T}),children:(0,R.jsx)(o.Z,{id:x,className:D})}),(0,R.jsxs)(h.Z,{direction:"vertical",children:[(0,R.jsx)("div",{dangerouslySetInnerHTML:{__html:v().sanitize(null!==(a=null==i?void 0:i.content)&&void 0!==a?a:"")},className:L}),l&&(0,R.jsxs)(d.Z,{gap:"small",children:[m?(0,R.jsx)("img",{src:m,alt:"",className:B}):(0,R.jsx)(c.Z,{name:"file-icon/".concat(y),width:24}),(0,R.jsx)(g.ZP,{type:"link",className:A,onClick:Q(l,i,"pdf"===y,p),children:null==u?void 0:u.doc_name})]})]})]},null==i?void 0:i.id)}),[n,G,Q]),V=(0,m.useCallback)((function(e){return k()(e,M,(function(e,n){var t=function(e){return Number(e.slice(2,-2))}(e);return(0,R.jsx)(f.Z,{content:W(t),children:(0,R.jsx)(l.Z,{className:z})},n)}))}),[W]);return(0,R.jsx)(y.U,{rehypePlugins:[function(){return function(e){(0,Z.S4)(e,"text",(function(e,n){var t=n.at(-1);"custom-typography"!==t.tagName&&"code"!==t.tagName&&(e.type="element",e.tagName="custom-typography",e.properties={},e.children=[{type:"text",value:e.value}])}))}},w.Z,_.Z],remarkPlugins:[C.Z,P.Z],className:F,components:{"custom-typography":function(e){var n=e.children;return V(n)},code:function(e){var n=e.children,t=e.className,r=(e.node,u()(e,q)),i=/language-(\w+)/.exec(t||"");return i?(0,R.jsx)(b.Z,a()(a()({},r),{},{PreTag:"div",language:i[1],children:String(n).replace(/\n$/,"")})):(0,R.jsx)("code",a()(a()({},r),{},{className:t,children:n}))}},children:H})}},35293:function(e,n,t){"use strict";t.d(n,{fL:function(){return o},oI:function(){return i}});var r=t(1079),a=t(96486),i=function(e,n){var t,i,u=(null===(t=e.message)||void 0===t?void 0:t.filter((function(e){return e.role===r.Cs.Assistant})).slice(1)).findIndex((function(e){return e.id===n.id})),o=(0,a.isEmpty)(null==n?void 0:n.reference)?(null!==(i=null==e?void 0:e.reference)&&void 0!==i?i:[])[u]:null==n?void 0:n.reference;return null!=o?o:{doc_aggs:[],chunks:[],total:0}},u=/(#{2}\d+\${2})/g,o=function(e){return e.replace(u,(function(e){return"~~".concat(e.slice(2,-2),"==")}))}},4772:function(e,n,t){"use strict";t.d(n,{Z:function(){return c}});var r=t(86250),a=t(38925),i=t(86968),u=(t(62435),"errorWrapper___QfVXQ"),o=t(86074),c=function(e){var n=e.children,t=(0,i.qM)("fileManager").t;return(0,o.jsx)(r.Z,{align:"center",justify:"center",className:u,children:(0,o.jsx)(a.Z,{type:"error",message:(0,o.jsx)("h2",{children:n||t("fileError")})})})}},64838:function(){},27922:function(){},15212:function(){},85777:function(){},76929:function(){},45036:function(){}}]);
//# sourceMappingURL=9859.64cad376.async.js.map